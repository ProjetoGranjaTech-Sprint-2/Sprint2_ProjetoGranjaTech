<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dash Galpões</title>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

    <link rel="stylesheet" href="../css/dashboard.css">

</head>

<body>

    <header>
        <div class="logo"></div>
        <nav>
            <ul>
                <li>Galpão</li>
                <li> <a href="./viewDashboards.html">Dashboards</a></li>
                <li>Avisos</li>
                <li>Ajuda</li>
            </ul>
        </nav>
        <div class="sair">
            <span class="material-symbols-outlined">
                logout
            </span>
            <p>Sair</p>
        </div>
    </header>

    <main>
        <section class="galpao">
            <div class="titulo-galpao">
                <h2>GALPÃO</h2>
            </div>
            <div>
                <section class="galpoes">
                    <ul class="selecao">
                        <div class="primeira-linha">
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <li class="caixas" itemscope itemtype="http://schema.org/Warehouse" itemid="1_galpão">
                                <h2 itemprop="nome">1</h2>
                                <button class="retangulo" itemprop="botão"></button>
                            </li>
                            <div title="Adicionar novo galpão" class="material-symbols-outlined botao_add"
                                onclick="inserirCliente()">add</div>
                        </div>
                    </ul>
                </section>
                <section class="kpi">
                    <div>
                        <span>CRÍTICO!</span>
                        <p>A partir 28° ou 70%</p>
                    </div>
                    <div>
                        <span>ATENÇÃO!</span>
                        <p>A partir 25° ou 65%</p>
                    </div>
                    <div>
                        <span>ESTÁVEL</span>
                        <p>A partir 20° ou 55%</p>
                    </div>
                    <div>
                        <span>ATENÇÃO!</span>
                        <p> Abaixo 17° ou 40%</p>
                    </div>
                    <div>
                        <span>CRÍTICO!</span>
                        <p> Abaixo 15° ou 30%</p>
                    </div>
                </section>
            </div>
        </section>
    </main>
</body>

</html>

<script>


    var idUsuario = sessionStorage.ID_USUARIO;

    function inserirCliente() {

        fetch(`/dashboard/inserir/galpoes`, {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    console.log('TUDO CERTO POR AQUI')
                    select();
                } else {
                    throw "Houver um erro ao tentar pegar os galpões do cliente!"
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            })
        return false;
    }

    function select() {

        fetch(`/dashboard/selecionar/galpoes`, {
            method: 'POST',
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    resposta.json().then(result => {

                        adicionar(result);
                    })
                } else {
                    throw "Houver um erro ao tentar pegar os galpões do cliente!"
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            })
        return false;

    }

    function adicionar(result) {
        const selecao = document.querySelector(".primeira-linha");
        console.log('adicionar [AQUI] => ', result)

        for (i in result) {

            var element_li = document.createElement('li');
            var element_h2 = document.createElement('h2');
            var element_button = document.createElement('button');

            element_li.classList += "caixas"
            element_li.setAttribute('itemscope', '');
            element_li.setAttribute('itemtype', 'http://schema.org/Warehouse');
            element_li.setAttribute('itemid', i + '_galpão');

            element_h2.setAttribute('itempromp', 'nome');
            element_h2.innerHTML = i

            element_button.className += "retangulo";
            element_button.setAttribute('itempromp', 'botão');

            element_li.appendChild(element_h2);
            element_li.appendChild(element_button);

            selecao.appendChild(element_li)
        }



        console.log('aqui')
    }

</script>